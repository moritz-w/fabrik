/**
 * Password Element
 *
 * @copyright: Copyright (C) 2005-2016  Media A-Team, Inc. - All rights reserved.
 * @license:   GNU/GPL http://www.gnu.org/copyleft/gpl.html
 */
define(["jquery","fab/element"],(function(e,n){return window.FbPassword=new Class({Extends:n,options:{progressbar:!1},initialize:function(e,n){this.parent(e,n),this.options.editable&&this.ini()},ini:function(){this.pwRequirementsIndicator=this.getContainer().getElement("#pw-requirements-indicator"),"null"===typeOf(this.pwRequirementsIndicator)&&console.log("Password requirements indicator not found in DOM!"),this.pwMinLen=Joomla.getOptions("passwordMinLength"),this.pwMinInts=Joomla.getOptions("passwordMinIntegers"),this.pwMinSymbols=Joomla.getOptions("passwordMinSymbols"),this.pwMinUppercase=Joomla.getOptions("passwordMinUppercase"),this.pwMinLowercase=Joomla.getOptions("passwordMinLowercase"),this.pwRequirementMinLenText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_LENGTH")+": "+this.pwMinLen,this.pwRequirementMinIntsText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_INTEGERS")+": "+this.pwMinInts,this.pwRequirementMinSymbolsText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_SYMBOLS")+": "+this.pwMinSymbols+" ("+Joomla.JText._("PLG_ELEMENT_PASSWORD_ONE_OF")+": @$!%*#?&)",this.pwRequirementMinUppercaseText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_UPPERCASE")+": "+this.pwMinUppercase,this.pwRequirementMinLowercaseText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_LOWERCASE")+": "+this.pwMinLowercase,this.element&&this.element.addEvent("keyup",function(e){this.passwordChanged(e)}.bind(this)),!0===this.options.ajax_validation&&this.getConfirmationField().addEvent("blur",function(e){this.callvalidation(e)}.bind(this)),""===this.getConfirmationField().get("value")&&(this.getConfirmationField().value=this.element.value),this.getConfirmationField().addEvent("keyup",function(e){this.passwordChanged(e)}.bind(this)),Fabrik.addEvent("fabrik.form.doelementfx",function(n,t,s,i){if(n===this.form&&s===this.strElement)switch(t){case"disable":e(this.getConfirmationField()).prop("disabled",!0);break;case"enable":e(this.getConfirmationField()).prop("disabled",!1);break;case"readonly":e(this.getConfirmationField()).prop("readonly",!0);break;case"notreadonly":e(this.getConfirmationField()).prop("readonly",!1)}}.bind(this))},callvalidation:function(e){this.form.doElementValidation(e,!1,"_check")},cloned:function(e){console.log("cloned"),this.parent(e),this.ini()},passwordChanged:function(){var n=this.element,t=this.getConfirmationField(),s="";if("null"!==typeOf(this.pwRequirementsIndicator)){let e,i=0;for(n.value.length>=this.pwMinLen?s+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinLenText+"</span><br/>":s+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinLenText+"</span><br/>",i=0,e=new RegExp("[0-9]","g");e.test(n.value);)i++;for(i>=this.pwMinInts?s+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinIntsText+"</span><br/>":s+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinIntsText+"</span><br/>",i=0,e=new RegExp("[@$!%*#?&]","g");e.test(n.value);)i++;for(i>=this.pwMinSymbols?s+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinSymbolsText+"</span><br/>":s+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinSymbolsText+"</span><br/>",i=0,e=new RegExp("[A-Z]","g");e.test(n.value);)i++;for(i>=this.pwMinUppercase?s+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinUppercaseText+"</span><br/>":s+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinUppercaseText+"</span><br/>",i=0,e=new RegExp("[a-z]","g");e.test(n.value);)i++;i>=this.pwMinLowercase?s+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinLowercaseText+"</span><br/>":s+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinLowercaseText+"</span><br/>",""!=n.value&&t.value==n.value?s+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+Joomla.JText._("PLG_ELEMENT_PASSWORD_MATCH")+"</span>":s+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+Joomla.JText._("PLG_ELEMENT_PASSWORD_DONT_MATCH")+"</span>",this.pwRequirementsIndicator.set("html",s)}var i=this.getContainer().getElement(".strength");if("null"!==typeOf(i)){s="";var a=new RegExp("^(?=.{6,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$","g"),o=new RegExp("^(?=.{6,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$","g"),r=new RegExp("(?=.{6,}).*","g");if(this.options.progressbar){var l,p="";a.test(n.value)?(p=Joomla.JText._("PLG_ELEMENT_PASSWORD_STRONG"),l=e(Fabrik.jLayouts["fabrik-progress-bar-strong"])):o.test(n.value)?(p=Joomla.JText._("PLG_ELEMENT_PASSWORD_MEDIUM"),l=e(Fabrik.jLayouts["fabrik-progress-bar-medium"])):r.test(n.value)?(p=Joomla.JText._("PLG_ELEMENT_PASSWORD_WEAK"),l=e(Fabrik.jLayouts["fabrik-progress-bar-weak"])):(p=Joomla.JText._("PLG_ELEMENT_PASSWORD_MORE_CHARACTERS"),l=e(Fabrik.jLayouts["fabrik-progress-bar-more"]));var c={title:p};e(l).tooltip(c),e(i).replaceWith(l)}else s=!1===r.test(n.value)?"<span>"+Joomla.JText._("PLG_ELEMENT_PASSWORD_MORE_CHARACTERS")+"</span>":a.test(n.value)?'<span style="color:green">'+Joomla.JText._("PLG_ELEMENT_PASSWORD_STRONG")+"</span>":o.test(n.value)?'<span style="color:orange">'+Joomla.JText._("PLG_ELEMENT_PASSWORD_MEDIUM")+"</span>":'<span style="color:red">'+Joomla.JText._("PLG_ELEMENT_PASSWORD_WEAK")+"</span>",i.set("html",s)}},getConfirmationField:function(){return this.getContainer().getElement("input[name*=check]")}}),window.FbPassword}));
