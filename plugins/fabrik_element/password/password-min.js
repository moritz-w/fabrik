/**
 * Password Element
 *
 * @copyright: Copyright (C) 2005-2016  Media A-Team, Inc. - All rights reserved.
 * @license:   GNU/GPL http://www.gnu.org/copyleft/gpl.html
 */
define(["jquery","fab/element"],(function(e,t){return window.FbPassword=new Class({Extends:t,options:{progressbar:!1},initialize:function(e,t){this.parent(e,t),this.options.editable&&this.ini()},ini:function(){this.pwRequirementsIndicator=this.getContainer().getElement("#pw-requirements-indicator"),"null"===typeOf(this.pwRequirementsIndicator)&&console.log("Password requirements indicator not found in DOM!"),this.pwMinLen=Joomla.getOptions("passwordMinLength"),this.pwMinInts=Joomla.getOptions("passwordMinIntegers"),this.pwMinSymbols=Joomla.getOptions("passwordMinSymbols"),this.pwMinUppercase=Joomla.getOptions("passwordMinUppercase"),this.pwMinLowercase=Joomla.getOptions("passwordMinLowercase"),this.pwRequirementMinLenText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_LENGTH")+": "+this.pwMinLen,this.pwRequirementMinIntsText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_INTEGERS")+": "+this.pwMinInts,this.pwRequirementMinSymbolsText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_SYMBOLS")+": "+this.pwMinSymbols+" (one of: @$!%*#?&)",this.pwRequirementMinUppercaseText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_UPPERCASE")+": "+this.pwMinUppercase,this.pwRequirementMinLowercaseText=Joomla.JText._("PLG_ELEMENT_PASSWORD_MIN_LOWERCASE")+": "+this.pwMinLowercase,this.element&&this.element.addEvent("keyup",function(e){this.passwordChanged(e)}.bind(this)),!0===this.options.ajax_validation&&this.getConfirmationField().addEvent("blur",function(e){this.callvalidation(e)}.bind(this)),""===this.getConfirmationField().get("value")&&(this.getConfirmationField().value=this.element.value),Fabrik.addEvent("fabrik.form.doelementfx",function(t,n,s,i){if(t===this.form&&s===this.strElement)switch(n){case"disable":e(this.getConfirmationField()).prop("disabled",!0);break;case"enable":e(this.getConfirmationField()).prop("disabled",!1);break;case"readonly":e(this.getConfirmationField()).prop("readonly",!0);break;case"notreadonly":e(this.getConfirmationField()).prop("readonly",!1)}}.bind(this))},callvalidation:function(e){this.form.doElementValidation(e,!1,"_check")},cloned:function(e){console.log("cloned"),this.parent(e),this.ini()},passwordChanged:function(){var t=this.element,n="";if("null"!==typeOf(this.pwRequirementsIndicator)){let e,s=0;for(t.value.length>=this.pwMinLen?n+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinLenText+"</span><br/>":n+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinLenText+"</span><br/>",s=0,e=new RegExp("[0-9]","g");e.test(t.value);)s++;for(s>=this.pwMinInts?n+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinIntsText+"</span><br/>":n+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinIntsText+"</span><br/>",s=0,e=new RegExp("[@$!%*#?&]","g");e.test(t.value);)s++;for(s>=this.pwMinSymbols?n+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinSymbolsText+"</span><br/>":n+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinSymbolsText+"</span><br/>",s=0,e=new RegExp("[A-Z]","g");e.test(t.value);)s++;for(s>=this.pwMinUppercase?n+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinUppercaseText+"</span><br/>":n+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinUppercaseText+"</span><br/>",s=0,e=new RegExp("[a-z]","g");e.test(t.value);)s++;s>=this.pwMinLowercase?n+='<span style="color: #10D23E;"><span class="icon-checkmark"> </span> '+this.pwRequirementMinLowercaseText+"</span>":n+='<span style="color: #DB1717;"><span class="icon-cancel-2"> </span> '+this.pwRequirementMinLowercaseText+"</span>",this.pwRequirementsIndicator.set("html",n)}var s=this.getContainer().getElement(".strength");if("null"!==typeOf(s)){n="";var i=new RegExp("^(?=.{6,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$","g"),a=new RegExp("^(?=.{6,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$","g"),o=new RegExp("(?=.{6,}).*","g");if(this.options.progressbar){var r,p="";i.test(t.value)?(p=Joomla.JText._("PLG_ELEMENT_PASSWORD_STRONG"),r=e(Fabrik.jLayouts["fabrik-progress-bar-strong"])):a.test(t.value)?(p=Joomla.JText._("PLG_ELEMENT_PASSWORD_MEDIUM"),r=e(Fabrik.jLayouts["fabrik-progress-bar-medium"])):o.test(t.value)?(p=Joomla.JText._("PLG_ELEMENT_PASSWORD_WEAK"),r=e(Fabrik.jLayouts["fabrik-progress-bar-weak"])):(p=Joomla.JText._("PLG_ELEMENT_PASSWORD_MORE_CHARACTERS"),r=e(Fabrik.jLayouts["fabrik-progress-bar-more"]));var l={title:p};e(r).tooltip(l),e(s).replaceWith(r)}else n=!1===o.test(t.value)?"<span>"+Joomla.JText._("PLG_ELEMENT_PASSWORD_MORE_CHARACTERS")+"</span>":i.test(t.value)?'<span style="color:green">'+Joomla.JText._("PLG_ELEMENT_PASSWORD_STRONG")+"</span>":a.test(t.value)?'<span style="color:orange">'+Joomla.JText._("PLG_ELEMENT_PASSWORD_MEDIUM")+"</span>":'<span style="color:red">'+Joomla.JText._("PLG_ELEMENT_PASSWORD_WEAK")+"</span>",s.set("html",n)}},getConfirmationField:function(){return this.getContainer().getElement("input[name*=check]")}}),window.FbPassword}));
